# Refactoring Plan: Script Naming & Dataset Paths

## Current State Analysis

### Finetuned Dataset (E:/datasets)
- **Location**: `/mnt/e/datasets/` (228GB)
- **Train**: 205 parts (~1B samples)
- **Format**: JSONL with trajectory data
- **Status**: âœ… Complete

### Repetitive Dataset (D:/repetitive-datasets)  
- **Location**: `/mnt/d/Research Experiments/manus_model/repetitive-datasets/` (78GB)
- **Progress**: ~51M samples (target 200M), ETA 6.2h
- **Status**: ðŸ”„ Running in background
- **Format**: JSONL Q&A pairs

---

## Proposed Changes

### 1. Script Renaming (New Order)

| Current Name | New Name | Purpose |
|---|---|---|
| `02_generate_trajectories.py` | `01_generate_finetuned_dataset.py` | Generate fullstack training data |
| `03_validate_trajectories.py` | `02_validate_finetuned_dataset.py` | Validate fullstack data |
| `11_generate_repetitive_prompts.py` | `03_generate_repetitive_dataset.py` | Generate repetitive Q&A data |
| `12_validate_repetitive_prompts.py` | `04_validate_repetitive_dataset.py` | Validate repetitive data |
| `01_download_benchmarks.py` | `05_download_benchmarks.py` | Download evaluation benchmarks |
| `04_sft_training.py` | `06_sft_training.py` | Supervised fine-tuning |
| `05_rejection_sampling.py` | `07_rejection_sampling.py` | Rejection sampling |
| `06_grpo_training.py` | `08_grpo_training.py` | GRPO training |
| `07_tool_integration.py` | `09_tool_integration.py` | Tool integration fine-tuning |
| `08_comprehensive_eval.py` | `10_comprehensive_eval.py` | Comprehensive evaluation |
| `09_multi_agent_orchestration.py` | `11_multi_agent_orchestration.py` | Multi-agent setup |
| `10_deployment_configs.py` | `12_deployment_configs.py` | Deployment configurations |
| *(new)* | `13_run_benchmarks.py` | Run actual benchmarking |

### 2. Dataset Path Changes

| Dataset | Current Path | New Path |
|---|---|---|
| Finetuned | `/mnt/e/datasets/` | `/mnt/e/finetuned-fullstack-dataset/` |
| Repetitive | `/mnt/d/.../repetitive-datasets/` | `/mnt/e/repetitive-query-dataset/` |

### 3. Core Module Creation

New `core/` directory with:
- `model_config.py` - Universal model configuration
- `chat_templates.py` - Chat template registry  
- `lora_targets.py` - Auto-detect LoRA modules
- `tool_schemas.py` - Native vs custom tool format

---

## Execution Steps

### Phase 1: Move Existing Data (Non-destructive)

```bash
# Move finetuned dataset
mv /mnt/e/datasets /mnt/e/finetuned-fullstack-dataset

# Create repetitive dataset target (will move after generation completes)
mkdir -p /mnt/e/repetitive-query-dataset/{train,val,test}
```

### Phase 2: Rename Scripts

```bash
cd /mnt/d/Research\ Experiments/manus_model

# Rename in order
mv 02_generate_trajectories.py 01_generate_finetuned_dataset.py
mv 03_validate_trajectories.py 02_validate_finetuned_dataset.py
mv 11_generate_repetitive_prompts.py 03_generate_repetitive_dataset.py
mv 12_validate_repetitive_prompts.py 04_validate_repetitive_dataset.py
mv 01_download_benchmarks.py 05_download_benchmarks.py
mv 04_sft_training.py 06_sft_training.py
mv 05_rejection_sampling.py 07_rejection_sampling.py
mv 06_grpo_training.py 08_grpo_training.py
mv 07_tool_integration.py 09_tool_integration.py
mv 08_comprehensive_eval.py 10_comprehensive_eval.py
mv 09_multi_agent_orchestration.py 11_multi_agent_orchestration.py
mv 10_deployment_configs.py 12_deployment_configs.py
```

### Phase 3: Update Path References

Update all scripts that reference dataset paths:
- `01_generate_finetuned_dataset.py`: Output to `/mnt/e/finetuned-fullstack-dataset/`
- `03_generate_repetitive_dataset.py`: Output to `/mnt/e/repetitive-query-dataset/`
- `06_sft_training.py`: Load from new paths
- Shell scripts: Update all references

### Phase 4: Create Core Module

Create `/mnt/d/Research Experiments/manus_model/core/` with universal abstractions.

---

## Important Notes

> [!WARNING]
> The repetitive dataset generation is **currently running**. Do NOT move or modify `repetitive-datasets/` until it completes (ETA ~6h).

> [!IMPORTANT]
> After the running generation completes, we will:
> 1. Move generated data to `/mnt/e/repetitive-query-dataset/`
> 2. Update the script to use the new path
> 3. Delete the old `repetitive-datasets/` directory

---

## Files Affected

### Scripts to Rename (12 files)
- All numbered Python scripts in the root directory

### Scripts to Update (Path changes)
- `01_generate_finetuned_dataset.py` (was 02)
- `02_validate_finetuned_dataset.py` (was 03)
- `03_generate_repetitive_dataset.py` (was 11)
- `04_validate_repetitive_dataset.py` (was 12)
- `06_sft_training.py` (was 04)
- `run_complete_pipeline.sh`
- `run_full_pipeline.sh`
- `run_training_pipeline.sh`

### New Files to Create
- `core/__init__.py`
- `core/model_config.py`
- `core/chat_templates.py`
- `core/lora_targets.py`
- `core/tool_schemas.py`
- `13_run_benchmarks.py`
